# Wi-Fi Traffic Classification
This repository contains code and resources for analyzing and classifying Wi-Fi traffic using classical and machine learning techniques. The project aims to identify different types of network traffic based on their characteristics.

## Motivation
During summer, I usually spend some time with my girlfriend, in a remote city in the Italian Alps. We usually rely on a 5G hotspot for internet access, but the connection can be unstable at times. Its performance is fine, but when she turns on her smartphone, it becomes absolutely unusable. The question "What the heck is she looking at?" often comes to mind, and it made me wonder about the nature of the traffic being generated by her device. She truly is an inspiration for this project.

## Setup notes
First of all, my environment is a MacBook Pro M1, running macOS Sequoia 15.6. I use Homebrew to manage my packages, and I have Python 3.13 installed.

To install the necessary packages and applications for the project:

```bash
brew install python
brew install wireshark
brew install wireshark-app
```
The difference between `wireshark` and `wireshark-app` is that the former installs the command-line tools, while the latter installs the GUI application. Additional tools that are part of Wireshark CLI are needed for this project.

### Virtual Environment
The scripts will run in a virtual environment. To set it up, you can use the following commands:

```bash
python -m venv .venv \
source .venv/bin/activate \
pip install -r requirements.txt
```

### Sniffing procedure
The `airport` command is deprecated, and the replacement command line tool `wdutil` does not serve the same purpose. Therefore, I had to use the GUI tool Wireless Diagnostics to enable the monitor mode in Wireshark.
```
Wireless Diagnostics -> Window -> Sniffer
```
After selecting the correct channel and bandwidth in the Wireless Diagnostics tool, it's possible to proceed with the capture in Wireshark.

### Folder structure
The project is structured as follows:

```.
wifi-traffic-classification/
├── data/
│   ├── plot_iat_avg_W15.png
│   ├── plot_iat_var_W15.png
│   ├── plot_pkt_size_avg_W15.png
│   ├── plot_pps_W15.png
│   ├── plot_rssi_W15.png
│   └── plot_throughput_W15.png
│
├── private/
│   ├── traffic.csv
│   └── capture.pcapng
│
├── src/
│   └── plots.py
│
└── requirements.txt
```

The folders respect the following logic:
- `data/`: contains all the data files, mostly the generated plots.
- `private/`: contains sensitive data that will not be shared publicly. Contains the original capture and its processing results. Can be requested by the course instructor.
- `src/`: contains the source code for the project, including any scripts or modules used for analysis and visualization.
- `requirements.txt`: lists the Python packages required to run the project.

## Capture Processing
I personally found it easier to convert the whole Wireshark capture file into a format that can be processed by pandas easily, in particular `.csv`. To do so, it's possible to use the `tshark` command-line tool that comes with Wireshark. The following command can be used to filter and copy certain information from a `.pcap` or `.pcapng` file to a `.csv`:

```bash
tshark -r ./private/capture.pcapng \
  -Y "wlan.addr == XX:XX:XX:XX:XX:XX && wlan.fc.type=2" \
  -T fields -E header=y -E separator=, -E quote=d \
  -e frame.time_epoch \
  -e frame.len \
  -e wlan.sa -e wlan.da -e wlan.ta -e wlan.ra \
  -e wlan.fc.type -e wlan.fc.subtype \
  -e wlan.fc.pwrmgt \
  -e radiotap.dbm_antsignal \
  -e wlan.qos.priority \
> ./private/traffic.csv
```

### Classical analysis
The first part of this project focuses on classical traffic analysis without machine learning.
The script src/plots.py processes the CSV exported with tshark and computes several statistical features of Wi-Fi traffic for a given station MAC address.

Specifically, the script:
- Splits the traffic into fixed-size time windows (default: 15 seconds).
- Separates uplink and downlink packets.
- Computes per-window features:
    - RSSI [dBm]
    - Throughput [Mb/s]
    - Packets per second [PPS]
    - Average and variance of packet size
    - Average and variance of inter-arrival time
    - Quality of Service (QoS) distribution
- Extracts the Power Management bit to determine when the station is in sleep or awake mode, highlighting sleep periods in the plots.
- Produces time-series plots of all the above features, saved as .png images in the data/ folder.

This step provides a feature extraction and visualization pipeline that will serve as the foundation for the next stage, where machine learning techniques will be applied to classify user activities from encrypted Wi-Fi traffic.

### Machine Learning Approach

## Results